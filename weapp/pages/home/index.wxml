<sidebar 
  show="{{showSidebar}}" 
  bind:close="closeSidebar" 
  bind:toggleView="toggleView"
  userInfo="{{userInfo}}"
  isHistoryView="{{isHistoryView}}"
></sidebar>
<view class="page-container {{showSidebar ? 'sidebar-open' : ''}}">
  <custom-header 
    title="{{isHistoryView ? 'å†å²ä»»åŠ¡' : 'ğŸ‘‹ æ¬¢è¿'}}" 
    bind:toggleSidebar="toggleSidebar"
  ></custom-header>



  <view class="container {{hasSchedules ? 'container-with-schedules' : ''}}" style="padding-top: {{containerPadding}}px;">
    <view class="schedule-container">
      <view class="custom-refresh {{isRefreshing ? 'refreshing' : ''}}">
        <view class="refresh-icon"></view>
        <text class="refresh-text">{{isRefreshing ? 'åˆ·æ–°ä¸­...' : 'ä¸‹æ‹‰åˆ·æ–°'}}</text>
      </view>
      
      <block wx:if="{{hasSchedules}}">
        <view class="schedule-list">
          <block wx:for="{{timeSections}}" wx:key="title">
            <view class="time-section">
              <view class="section-title">{{item.title}}</view>
              <view class="schedule-items">
                <view class="schedule-item" wx:for="{{item.schedules}}" wx:for-item="schedule" wx:key="id" bindtap="showScheduleDetails" data-schedule="{{schedule}}">
                  <view class="schedule-info">
                    <view class="schedule-header">
                      <text class="schedule-date">{{schedule.dateStr}}</text>
                      <text class="schedule-time">{{schedule.timeStr}}</text>
                    </view>
                    <text class="schedule-description">{{schedule.title}}</text>
                  </view>
                </view>
              </view>
            </view>
          </block>
        </view>
      </block>
      <view wx:else class="no-schedules">
        <image src="/static/relax12.png" mode="aspectFit" class="no-schedules-image"></image>
        <view class="no-schedules-text">
          <text class="primary-text">{{isHistoryView ? 'æ²¡æœ‰å†å²ä»»åŠ¡' : 'æ²¡æœ‰å¾…åŠä»»åŠ¡'}}</text>
          <text class="secondary-text">{{isHistoryView ? 'å»åˆ›å»ºä¸€äº›æ–°ä»»åŠ¡å§' : 'äº«å—ç¾å¥½çš„ä¸€å¤©å§'}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="add-button-container {{showAddButton && !isHistoryView ? '' : 'hide'}}">
    <view class="option-buttons-overlay {{showOptions ? 'show' : ''}}" bindtap="hideAddOptions"></view>
    <view class="option-buttons {{showOptions ? 'show' : ''}}">
      <view class="option-button pdf-option" bindtap="addFromPDF">
        <image class="option-icon" src="/static/pdf.png" mode="aspectFit"></image>
        <text class="option-text">PDF</text>
      </view>
      <view class="option-button image-option" bindtap="addFromImage">
        <image class="option-icon" src="/static/img.png" mode="aspectFit"></image>
        <text class="option-text">å›¾ç‰‡</text>
      </view>
      <view class="option-button text-option" bindtap="addFromText">
        <image class="option-icon" src="/static/text.png" mode="aspectFit"></image>
        <text class="option-text">æ–‡å­—</text>
      </view>
    </view>
    <view class="add-button {{showOptions ? 'cancel' : ''}}" bindtap="toggleAddOptions">
      <text class="{{showOptions ? 'cancel-icon' : 'add-icon'}}">{{showOptions ? '+' : '+'}}</text>
    </view>
  </view>

  <schedule-details
    show="{{showDetails}}"
    loadingDetails="{{loadingDetails}}"
    scheduleInfo="{{scheduleInfo}}"
    lastScheduleType="{{lastScheduleType}}"
    lastScheduleText="{{lastScheduleText}}"
    keyboardHeight="{{keyboardHeight}}"
    isNewSchedule="{{isNewSchedule}}"
    bind:hide="onDetailsClose"
    bind:create="onScheduleCreate"
    bind:retry="retry"
    bind:refresh="onScheduleRefresh"
  ></schedule-details>

  <view class="overlay {{showOverlay ? 'show' : ''}}"></view>

  <!-- åœ¨ <view class="page-container"> å†…éƒ¨ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç  -->
  <view class="input-overlay {{showTextInput ? 'show' : ''}}" bindtap="hideTextInput"></view>

  <!-- ä¿®æ”¹æ–‡æœ¬è¾“å…¥å¼¹å‡ºæ¡†éƒ¨åˆ† -->
  <view class="text-input-popup {{showTextInput ? 'show' : ''}}" style="bottom: {{keyboardHeight}}px;">
    <view class="text-input-content">
      <textarea
        class="text-input-area"
        placeholder="è¯·è¾“å…¥æ—¥ç¨‹å†…å®¹"
        value="{{inputText}}"
        bindinput="onTextInput"
        focus="{{textareaFocus}}"
        maxlength="-1"
        adjust-position="{{false}}"
        show-confirm-bar="{{false}}"
      ></textarea>
      <view class="button-container">
        <view class="try-button" bindtap="justTryText">
          <text class="try-text">éšä¾¿è¯•è¯•</text>
        </view>
        <view class="send-button {{inputText ? '' : 'inactive'}}" bindtap="sendText">
          <image class="send-icon" src="/static/send.png" mode="aspectFit"></image>
        </view>
      </view>
    </view>
  </view>
</view>
